<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>DHT11</title>
	<script type="text/javascript" src = "https://canvasjs.com/assets/script/canvasjs.min.js" ></script>>
</head>
<body>
	<h1> 1. THONG SO NHIET DO, DO AM</h><br>
		<h2> Temprature</h2> <input type="text" size="6" id="temp">&#176;C<br>
		<h2> Humidity</h2> <input type="text" size="6" id="humd">%<br>
		<h1> 2. DO THI</h1><br>
		<div id="ChartContainer" style="height: 300px; width:80%;"></div>
		<script type="text/javascript">
			function httpGetAsync(theUrl, callback) {
					var xmlHttp = new XMLHttpRequest();
					xmlHttp.onreadystatechange = function() {
				if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
				callback(JSON.parse(xmlHttp.responseText));
				}
			xmlHttp.open("GET", theUrl, true); 
			xmlHttp.send(null);
		}
			window.onload = function() {
				var dataTemp = [];
				var dataHumd = [];
				var Chart = new CanvasJS.Chart("ChartContainer", {
					zoomEnabled: true, 
						text: "Temprature & Humidity" 
					},
					toolTip: { 
						shared: true
					},
					axisX: {
						title: "chart updates every 2 secs" 
					},
					data: [{
						
							type: "line", 
							xValueType: "dateTime", 
							showInLegend: true, 
							name: "temp",
							dataPoints: dataTemp 
						},
						{
							type: "line",
							xValueType: "dateTime",
							showInLegend: true,
							name: "humd",
							dataPoints: dataHumd
						}
						],
					});
				var yHumdVal = 0; 
				var yTempVal = 0; 
				var updateInterval = 2000; 
				var time = new Date(); 
				var updateChart = function() {
					httpGetAsync('/get', function(data) {
							
						document.getElementById("temp").value = data[0].temp;
						document.getElementById("humd").value = data[0].humd;
						console.log(data);
						time.setTime(time.getTime() + updateInterval);
						yTempVal = parseInt(data[0].temp);
						yHumdVal = parseInt(data[0].humd);
						dataTemp.push({ // cập nhât dữ liệu mới từ server
								x: time.getTime(),
								y: yTempVal
							});
							dataHumd.push({
								x: time.getTime(),
								y: yHumdVal
							});
							Chart.render(); // chuyển đổi dữ liệu của của graph thành mô hình đồ họa
						});
					};
					updateChart(); // Chạy lần đầu tiên
					setInterval(function() { // Cập nhật lại giá trị graph sau thời gian updateInterval
						updateChart()
					}, updateInterval);
				}
		</script>

</body>
</html>>